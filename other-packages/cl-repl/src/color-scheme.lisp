(in-package :cl-repl)

(defvar *color-schemes* (make-hash-table :test #'equal))

(defun find-color-scheme (name)
  (gethash name *color-schemes*))

(defmacro define-color-scheme (name (&optional parent) &body specs)
  `(setf (gethash ,name *color-schemes*) (cons ,parent ',specs)))

(defun set-color (spec color)
  (eval (read-from-string (format nil "(setf cl-repl::*~a-color* ~a)" spec color))))

(defun color-scheme (name)
  (let ((scheme (find-color-scheme name)))
    (when (car scheme)
      (color-scheme (car scheme)))
    (loop :for (spec color) :in (cdr scheme)
          :do (set-color spec color))))

(define-color-scheme "default" ()
  ("magic-syntax" 39)
  ("string-syntax" 184)
  ("variable-syntax" 118)
  ("constant-syntax" 118)
  ("lambda-syntax" 39)
  ("definition-syntax" 118)
  ("keyword-syntax" 39)
  ("special-syntax" 197)
  ("function-syntax" 197)
  ("boolean-syntax" 197)
  ("normal-syntax" nil)
  ("default-prompt" 40)
  ("debugger-prompt" 9)
  ("output-indicator" 9)
  ("condition" 9)
  ("section" 21)
  ("message" 248)
  ("logo" 9))

(define-color-scheme "off" ()
  ("magic-syntax" nil)
  ("string-syntax" nil)
  ("variable-syntax" nil)
  ("constant-syntax" nil)
  ("lambda-syntax" nil)
  ("definition-syntax" nil)
  ("keyword-syntax" nil)
  ("special-syntax" nil)
  ("function-syntax" nil)
  ("boolean-syntax" nil)
  ("normal-syntax" nil)
  ("default-prompt" nil)
  ("debugger-prompt" nil)
  ("output-indicator" nil)
  ("condition" nil)
  ("section" nil)
  ("message" nil)
  ("logo" nil))


